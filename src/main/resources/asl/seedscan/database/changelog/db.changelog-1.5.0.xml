<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">
  <changeSet author="dwitte" id="add_grouptypeview_view">
    <sql stripComments="true">      
        CREATE OR REPLACE VIEW public.grouptypeview
         AS
         SELECT grpt."pkGroupTypeID",
            grpt.name,
            grp.pkgroupid
           FROM "tblGroupType" grpt
             JOIN "tblGroup" grp ON grp."fkGroupTypeID" = grpt."pkGroupTypeID"
          ORDER BY grpt."pkGroupTypeID", grp.pkgroupid;
    </sql>
  </changeSet>
  <changeSet author="dwitte" id="add_groupview_view">
    <sql stripComments="true">      
        CREATE OR REPLACE VIEW public.groupview
         AS
         SELECT "tblGroup".pkgroupid,
            "tblGroup".name,
            "tblGroup"."fkGroupTypeID"
           FROM "tblGroup"
          ORDER BY "tblGroup".pkgroupid;
    </sql>
  </changeSet>
  <changeSet author="dwitte" id="add_stationview_view">
    <sql stripComments="true">      
        CREATE OR REPLACE VIEW public.stationview
         AS
         SELECT sta.pkstationid,
            sta.fknetworkid,
            sta.name,
            sgt."fkGroupID"
           FROM tblstation sta
             JOIN "tblStationGroupTie" sgt ON sta.pkstationid = sgt."fkStationID"
          ORDER BY sta.pkstationid, sgt."fkGroupID";
    </sql>
  </changeSet>
  <changeSet author="dwitte" id="remove_legend">
    <dropColumn columnName="legend" tableName="tblmetric"/>
  </changeSet>
  <changeSet author="dwitte" id="add_metric_description">
    <addColumn tableName="tblmetric">
      <column name="descriptionshort" type="VARCHAR(128)"/>
      <column name="descriptionlong" type="TEXT"/>
    </addColumn>
  </changeSet>
  <changeSet author="dwitte" id="add_netsta_view">
     <sql stripComments="true">
         CREATE MATERIALIZED VIEW public.netstaview AS
         SELECT DISTINCT gp.name AS network, st.name AS station, MIN(md.date) AS mindate, MAX(md.date) AS maxdate FROM public."tblGroupType" gpt
         INNER JOIN public."tblGroup" gp ON gp."fkGroupTypeID"=gpt."pkGroupTypeID"
         INNER JOIN public.tblstation st ON st.fknetworkid=gp.pkgroupid
         INNER JOIN public.tblsensor sn ON sn.fkstationid=st.pkstationid
         INNER JOIN public.tblchannel ch ON ch.fksensorid=sn.pksensorid
         INNER JOIN public.tblmetricdata md ON md.fkchannelid=ch.pkchannelid
         WHERE gpt.name='Network Code'
         GROUP BY gp.name, st.name;
     </sql>
  </changeSet>
</databaseChangeLog>
